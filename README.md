Adapted from https://bitbucket.org/natecermak/wormimageanalysisr/src/master/
